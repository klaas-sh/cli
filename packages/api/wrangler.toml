# Klaas API - Cloudflare Workers Configuration
name = "klaas-api"
main = "src/index.ts"
compatibility_date = "2025-01-13"
compatibility_flags = ["nodejs_compat"]

# Development environment (default)
[[d1_databases]]
binding = "DB"
database_name = "klaas-db-local"
database_id = "local"
migrations_dir = "migrations"

[[kv_namespaces]]
binding = "RATE_LIMIT_KV"
id = "f636296cef0945b684f476d008d6d1ff"
preview_id = "f636296cef0945b684f476d008d6d1ff"

[[kv_namespaces]]
binding = "CACHE_KV"
id = "4608c1f35c4745328ec3bf5196eb7e90"
preview_id = "4608c1f35c4745328ec3bf5196eb7e90"

# Durable Objects for WebSocket management
[[durable_objects.bindings]]
name = "SESSION_HUB"
class_name = "SessionHub"

[[migrations]]
tag = "v1"
new_classes = ["SessionHub"]

# Environment variables
[vars]
ENVIRONMENT = "development"
API_VERSION = "v1"
DASHBOARD_URL = "http://localhost:3001"

# Staging environment
[env.staging]
name = "klaas-api-staging"
routes = [
  { pattern = "api-staging.klaas.sh", custom_domain = true }
]

[[env.staging.d1_databases]]
binding = "DB"
database_name = "klaas-db-staging"
database_id = "c673aec4-1103-401e-b5e3-66f541317e2a"
migrations_dir = "migrations"

[[env.staging.kv_namespaces]]
binding = "RATE_LIMIT_KV"
id = "f636296cef0945b684f476d008d6d1ff"

[[env.staging.kv_namespaces]]
binding = "CACHE_KV"
id = "4608c1f35c4745328ec3bf5196eb7e90"

[[env.staging.durable_objects.bindings]]
name = "SESSION_HUB"
class_name = "SessionHub"

[env.staging.vars]
ENVIRONMENT = "staging"
DASHBOARD_URL = "https://app-staging.klaas.sh"

# Production environment
[env.production]
name = "klaas-api-production"
routes = [
  { pattern = "api.klaas.sh", custom_domain = true }
]

[[env.production.d1_databases]]
binding = "DB"
database_name = "klaas-db-production"
database_id = "d1b9e170-1302-4f63-9605-094b699569d5"
migrations_dir = "migrations"

[[env.production.kv_namespaces]]
binding = "RATE_LIMIT_KV"
id = "932890ed6e24497d9c845aa329ab6d32"

[[env.production.kv_namespaces]]
binding = "CACHE_KV"
id = "5863e355f0a44a629dbe4c31421d93be"

[[env.production.durable_objects.bindings]]
name = "SESSION_HUB"
class_name = "SessionHub"

[env.production.vars]
ENVIRONMENT = "production"
DASHBOARD_URL = "https://app.klaas.sh"
